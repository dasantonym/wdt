/*! wdt webkit - v1.9.1 - 2015-03-21 */

!function(){"use strict";angular.module("app",["ngRoute","wdt.controllers.appear-disappear","wdt.controllers.capture-replay","wdt.controllers.main","wdt.controllers.reverse-delay","wdt.controllers.skel","wdt.controllers.space"]).config(["$routeProvider","$logProvider",function(a,b){b.debugEnabled(!0);var c="views/";a.when("/",{templateUrl:c+"main.html",controller:"Main"}),a.when("/appear-disappear",{templateUrl:c+"appear-disappear.html",controller:"AppearDisappear"})}])}(),function(){"use strict";angular.module("wdt.controllers.appear-disappear",[]).controller("AppearDisappear",["$scope",function(a){var b=require("opencv"),c=document.getElementById("canvas"),d=c.getContext("2d"),e=document.getElementById("video-container"),f=document.getElementById("canvas-container"),g=document.getElementById("OSD"),h=320,i=240,j=new b.VideoCapture(0),k=new b.WDT;j.setWidth(h),j.setHeight(i),window.onresize=function(){var a=window.innerWidth,b=window.innerHeight,c=Math.min(a/h,b/i);f.style.webkitTransform="scale("+c+","+c+")";var d=(a-h)/2,j=(b-i)/2;e.style.left=""+d+"px",e.style.top=""+j+"px",g.style.left=""+(a-h*c)/2+"px",g.style.top=""+(b-i*c)/2+"px"},document.onkeydown=function(b){switch(b.keyCode){case 81:j.close(),k=void 0,j=void 0,window.location="index.html";break;default:console.log("unhandled key code "+b.keyCode)}a.$apply()};var l=function(){j.read(function(a,b){k.appearDisappear(b,.01);for(var c=d.createImageData(b.width(),b.height()),e=b.width(),f=b.height(),g=0;f>g;g+=1)for(var h=0;e>h;h+=1){var i=b.pixel(g,h),j=4*(e*g+h);c.data[j]=i[2],c.data[j+1]=i[1],c.data[j+2]=i[0],c.data[j+3]=255}d.putImageData(c,0,0),window.setTimeout(l,10)})};window.onresize(),l()}])}(),function(){"use strict";angular.module("wdt.controllers.capture-replay",[]).controller("CaptureReplay",["$scope",function(a){function b(){i="countdown";var b,c=4;(b=function(){c--,0>=c?(i="record",j=[]):(a.toGo=c,setTimeout(b,1e3))})()}function c(){i="replay",m=0,n=1}function d(){i="reverse",m=l-1,n=-1}function e(){i="slowmotion",m=0,n=.33}var f=document.getElementById("canvas"),g=f.getContext("2d"),h=require("gstreamer-superficial"),i="menu",j=[],k=25,l=4*k,m=0,n=0,o=320,p=240,q={record:{x:.025,y:.525,w:.1,h:.1},replay:{x:.3,y:.525,w:.1,h:.1},reverse:{x:.45,y:.525,w:.1,h:.1},slowmotion:{x:.6,y:.525,w:.1,h:.1}},r="v4l2src ! tee name=t0  t0. ! queue max-size-buffers=1 ! videoconvert ! motion weight=0.3";for(var s in q){var t=q[s];r+=" ! triggers x="+t.x+" y="+t.y+" w="+t.w+" h="+t.h+" name="+s}r+=" ! fakesink  t0. ! queue max-size-buffers=1 ! videoconvert ! video/x-raw, format=RGBA, width=320, height=240 ! appsink name=sink";var u=new h.Pipeline(r),v=u.findChild("sink");for(s in q)q[s].trigger=u.findChild(s);var w=document.getElementById("video-container"),x=document.getElementById("canvas-container"),y=document.getElementById("OSD");window.onresize=function(){var a=window.innerWidth,b=window.innerHeight,c=Math.min(a/o,b/p);x.style.webkitTransform="scale("+c+","+c+")";var d=(a-o)/2,e=(b-p)/2;w.style.left=""+d+"px",w.style.top=""+e+"px",y.style.left=""+(a-o*c)/2+"px",y.style.top=""+(b-p*c)/2+"px"},window.onresize(),document.onkeydown=function(f){switch(f.keyCode){case 82:b();break;case 65:c();break;case 83:d();break;case 68:e();break;case 81:u.stop(),window.location="index.html";break;default:console.log("unhandled key code "+f.keyCode)}a.$apply()},v.pull(function(b){var c=g.createImageData(o,p);switch(c.data.set(b),i){case"menu":g.putImageData(c,0,0);for(s in q){var d=q[s];g.fillStyle="rgba(255,0,0,"+d.trigger.get("value")+")",g.fillRect(d.x*o,d.y*p,d.w*o,d.h*p),g.strokeStyle="#f00",g.lineWidth=1,g.strokeRect(d.x*o,d.y*p,d.w*o,d.h*p),d.trigger.get("ping")&&console.log("PING "+s)}break;case"countdown":g.putImageData(c,0,0);break;case"record":g.putImageData(c,0,0),j.push(c),j.length>=l&&(i="menu"),a.toGo=(l-j.length)/k;break;case"replay":case"reverse":case"slowmotion":m+=n;var e=Math.round(m);0>e||e>=j.length?i="menu":g.putImageData(j[e],0,0),a.debug={pos:e,speed:n};break;default:g.clearRect(0,0,o,p)}a.mode=i,a.$apply()},function(){}),u.play()}])}(),function(){"use strict";angular.module("wdt.controllers.main",[]).controller("Main",["$scope",function(a){a.tools=[{name:"Matching Positions",href:"#/space/positions",img:"img/matching-positions.png"},{name:"Inertia",href:"#/space/inertia",img:"img/inertia.png"},{name:"Cage",href:"#/space/cage",img:"img/cage.png"},{name:"Reverse and Delay",href:"#/reverse-delay",img:"img/reverse-and-delay.png"},{name:"Capture and Replay",href:"#/capture-replay",img:"img/capture-and-replay.png"},{name:"Appear - Disappear",href:"#/appear-disappear",img:"img/appear-disappear.png"}],a.toolRows=[];var b=[];for(var c in a.tools)b.push(a.tools[c]),3==b.length&&(a.toolRows.push(b),b=[]);a.toolRows.push(b),document.onkeydown=function(b){var c=b.keyCode-49;if(c>=0&&c<a.tools.length)return void(window.location=a.tools[c].href);switch(b.keyCode){case 81:global.window.nwDispatcher.requireNwGui().App.quit();default:console.log("unhandled key code "+b.keyCode)}}}])}(),function(){"use strict";angular.module("wdt.controllers.reverse-delay",[]).controller("ReverseDelay",["$scope",function(a){function b(a){a.beginPath(),a.moveTo(0,0),a.lineTo(3,7),a.lineTo(-3,7),a.closePath(),a.fill()}a.mode="Delay";var c=[],d=25,e=100,f=0,g=0,h=1;a.duration=e/d,a.changeBuffer=function(b){var i=e/d;switch(i+=b,1>i&&(i=1),i>10&&(i=10),e=i*d,c=[],a.mode){case"Delay":h=1,g=0,f=1;break;case"Reverse":h=-1,g=0,f=e-1}a.duration=i},a.switchMode=function(){"Delay"==a.mode?(a.mode="Reverse",h=-1,g=0,f=e-1):(a.mode="Delay",h=1,g=0,f=1)};var i=document.getElementById("canvas"),j=i.getContext("2d"),k=require("gstreamer-superficial"),l=320,m=240,n=new k.Pipeline("v4l2src ! videoconvert ! video/x-raw, format=RGBA, width=320, height=240 ! appsink name=sink"),o=n.findChild("sink"),p=document.getElementById("video-container"),q=document.getElementById("canvas-container"),r=document.getElementById("OSD");window.onresize=function(){var a=window.innerWidth,b=window.innerHeight,c=Math.min(a/l,b/m);q.style.webkitTransform="scale("+c+","+c+")";var d=(a-l)/2,e=(b-m)/2;p.style.left=""+d+"px",p.style.top=""+e+"px",r.style.left=""+(a-l*c)/2+"px",r.style.top=""+(b-m*c)/2+"px"},window.onresize(),document.onkeydown=function(b){switch(b.keyCode){case 38:a.changeBuffer(1);break;case 40:a.changeBuffer(-1);break;case 39:a.switchMode();break;case 37:a.switchMode();break;case 81:n.stop(),window.location="index.html";break;default:console.log("unhandled key code "+b.keyCode)}a.$apply()},o.pull(function(d){var i=j.createImageData(l,m);for(i.data.set(d),c[g]=i,g=(g+1)%e,f=(f+h)%e;0>f;)f=e-1;a.frames=c.length,a.playPosition=f,a.recordPosition=g,c.length>f?j.putImageData(c[f],0,0):j.clearRect(0,0,l,m);var k=150,n=10,o=150;j.strokeStyle="#fff",j.lineWidth=1,j.beginPath(),j.moveTo(k,n),j.lineTo(k+o,n),j.stroke(),j.save(),j.translate(k+o*g/e,n),j.fillStyle="#f00",b(j),j.restore(),j.save(),j.translate(k+o*f/e,n),j.fillStyle="#0f0",b(j),j.restore(),a.$apply()},function(){}),n.play()}])}(),function(){"use strict";angular.module("wdt.controllers.skel",[]).controller("Skel",["$scope",function(a){var b=document.getElementById("canvas"),c=b.getContext("2d"),d=require("gstreamer-superficial"),e=320,f=240,g=new d.Pipeline("v4l2src ! videoconvert ! video/x-raw, format=RGBA, width=320, height=240 ! appsink name=sink"),h=g.findChild("sink"),i=document.getElementById("video-container"),j=document.getElementById("canvas-container"),k=document.getElementById("OSD");window.onresize=function(){var a=window.innerWidth,b=window.innerHeight,c=Math.min(a/e,b/f);j.style.webkitTransform="scale("+c+","+c+")";var d=(a-e)/2,g=(b-f)/2;i.style.left=""+d+"px",i.style.top=""+g+"px",k.style.left=""+(a-e*c)/2+"px",k.style.top=""+(b-f*c)/2+"px"},window.onresize(),document.onkeydown=function(b){switch(b.keyCode){case 81:g.stop(),window.location="index.html";break;default:console.log("unhandled key code "+b.keyCode)}a.$apply()},h.pull(function(b){var d=c.createImageData(e,f);d.data.set(b),c.putImageData(d,0,0),a.$apply()},function(){}),g.play()}])}(),function(){"use strict";angular.module("wdt.controllers.space",[]).controller("Space",["$scope",function(a){function b(a){return a/180*-Math.PI}switch(window.location.hash){case"#inertia":a.exercises=[{type:"Inertia"}];break;case"#cage":a.exercises=[{type:"Cage",left:.2,top:.2,right:.8,bottom:1.1},{type:"Cage",left:.35,top:.15,right:.6,bottom:1.1}];break;default:a.exercises=[{type:"StandAtAngle",angle:45},{type:"StandAtAngle",angle:0},{type:"StandAtAngle",angle:180},{type:"StandAtAngle",angle:316},{type:"MoveTo",x:.8,y:.7},{type:"StandAtAngle",angle:95},{type:"MoveTo",x:.1,y:.75},{type:"StandAtAngle",angle:212},{type:"StandAtAngle",angle:114},{type:"MoveTo",x:.9,y:.23}]}a.exerciseIndex=0,a.exercise=a.exercises[a.exerciseIndex],a.nextExercise=function(){a.exerciseIndex=(a.exerciseIndex+1)%a.exercises.length,a.exercise=a.exercises[a.exerciseIndex]},a.previousExercise=function(){a.exerciseIndex=(a.exerciseIndex-1)%a.exercises.length,a.exerciseIndex<0&&(a.exerciseIndex=a.exercises.length-1),a.exercise=a.exercises[a.exerciseIndex]},a.exerciseDone=function(){a.nextExercise()},a.OSDOpacity=0;var c;a.showOSD=function(){a.OSDOpacity=1,c||(c=setInterval(function(){a.OSDOpacity*=.9,a.OSDOpacity<.01&&(a.OSDOpacity=0,clearInterval(c),c=void 0),a.$apply()},66))},a.threshold=100;var d=document.getElementById("canvas"),e=d.getContext("2d"),f=require("gstreamer-superficial"),g=320,h=240;a.inert={x:g/2,y:h/2},a.vel={x:0,y:0};var i=new f.Pipeline("v4l2src ! videoconvert ! video/x-raw, format=GRAY8, width=320, height=240 ! motion name=motion weight=0.000001 scale=2 shift=-10 ! videoconvert  ! flip h=true ! blur ! threshold name=threshold threshold="+a.threshold+" ! extremes name=extremes ! camshift name=camshift ! acc  ! multiplys scale=.6  ! videoconvert ! video/x-raw, format=RGBA ! appsink name=sink"),j=i.findChild("sink"),k=i.findChild("motion"),l=i.findChild("extremes"),m=i.findChild("camshift"),n=i.findChild("threshold"),o=document.getElementById("video-container"),p=document.getElementById("canvas-container"),q=document.getElementById("OSD");window.onresize=function(){var a=window.innerWidth,b=window.innerHeight,c=Math.min(a/g,b/h);p.style.webkitTransform="scale("+c+","+c+")";var d=(a-g)/2,e=(b-h)/2;o.style.left=""+d+"px",o.style.top=""+e+"px",q.style.left=""+(a-g*c)/2+"px",q.style.top=""+(b-h*c)/2+"px"},window.onresize(),document.onkeydown=function(b){switch(b.keyCode){case 38:a.threshold=Math.min(255,a.threshold+3),a.showOSD(),n.set("threshold",a.threshold);break;case 40:a.threshold=Math.max(0,a.threshold-3),a.showOSD(),n.set("threshold",a.threshold);break;case 39:a.nextExercise();break;case 37:a.previousExercise();break;case 32:k.set("reset",!0);break;case 81:i.stop(),window.location="index.html";break;default:console.log("unhandled key code "+b.keyCode)}a.$apply()},j.pull(function(c){var d=e.createImageData(g,h);d.data.set(c),e.putImageData(d,0,0);var f=a.extremes={left:l.get("left")*g,top:l.get("top")*h,right:l.get("right")*g,bottom:l.get("bottom")*h},i=a.centroid={x:m.get("x")*g,y:m.get("y")*h,width:m.get("width")*g,height:m.get("height")*h,angle:b(m.get("angle"))};e.fillStyle="#fff",e.save(),e.translate(i.x,i.y),e.rotate(i.angle),e.fillRect(-(i.width/2),-5,i.width,10),e.fillRect(-5,-(i.height/2),10,i.height),e.restore(),e.fillStyle="rgba(0,20,120,0.5)",e.fillRect(0,0,g,h),e.strokeStyle="#fff",e.lineWidth=2,e.strokeRect(f.left,f.top,f.right-f.left,f.bottom-f.top);var j=.05,k=1-j,n=a.inert,o=a.vel,p={x:i.x-n.x,y:i.y-n.y};p.x*=j,p.y*=j,o.x*=k,o.y*=k,o.x+=p.x,o.y+=p.y,n.x+=o.x,n.y+=o.y,a.inert=n,a.vel=o;var q=a.exercise;e.fillStyle="#f00";var r=2,s=30;switch(e.save(),q.type){case"StandAtAngle":var t=b(q.angle);e.translate(g/2,h/2),e.rotate(t),e.fillRect(-g/2,-2,g,4);var u=Math.abs(t-i.angle);a.delta=u,u<b(3)&&a.exerciseDone();break;case"MoveTo":var v=q.x*g,w=q.y*h;e.fillRect(v-r,w-s,2*r,2*s),e.fillRect(v-s,w-r,2*s,2*r);var p={x:v-i.x,y:w-i.y},u=Math.sqrt(p.x*p.x+p.y*p.y);a.delta=u,10>u&&a.exerciseDone();break;case"Cage":var x={l:q.left*g,t:q.top*h,r:q.right*g,b:q.bottom*h},y=x.l<f.left&&x.t<f.top&&x.r>f.right&&x.b>=f.bottom;a.insideCage=y,e.strokeStyle=y?"#0f0":"#f00",e.lineWidth=2,e.strokeRect(x.l,x.t,x.r-x.l,x.b-x.t);break;case"Inertia":var v=a.inert.x,w=a.inert.y;e.fillRect(v-r,w-s,2*r,2*s),e.fillRect(v-s,w-r,2*s,2*r)}e.restore(),a.$apply()},function(){}),i.play()}])}();